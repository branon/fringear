<!doctype html>
<html lang="en">
    <head>
        <title>Argon Sound Demo</title>
        <link rel="apple-touch-icon" href="images/sample_icon_57x57.png" />
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="arenabled" />
        <script>
            var myAppController =
            {

                onArgonReady : function()
                {
                    var urls = []; // sounds go here

                }

                // do something with vars
            };

            document.addEventListener("AR.ArgonReadyEvent", myAppController.onArgonReady);


            (function() {
                var context
                  , soundSource
                  , soundBuffer
                  , url = 'audio/roost.mp3';

                // Step 1 - Initialise the Audio Context
                // There can be only one!

                function init() {
                    if (typeof AudioContext !== "undefined") {
                        context = new AudioContext();
                    } else if (typeof webkitAudioContext !== "undefined") {
                        context = new webkitAudioContext();
                    } else {
                        throw new Error('AudioContext not supported. :(');
                    }
                }

                // Step 2: Load our Sound using XHR

                function startSound() {
                    // Note: this loads asynchronously
                    var request = new XMLHttpRequest();
                    request.open("GET", url, true);
                    request.responseType = "arraybuffer";

                    // Our asynchronous callback
                    request.onload = function() {
                        var audioData = request.response;

                        audioGraph(audioData);


                    };

                    request.send();
                }

                // Finally: tell the source when to start

                function playSound() {
                    // play the source now
                    soundSource.noteOn(context.currentTime);
                }

                function stopSound() {
                    // stop the source now
                    soundSource.noteOff(context.currentTime);
                }

                // This is the code we are interested in:
                function audioGraph(audioData) {
                    soundSource = context.createBufferSource();
                    soundBuffer = context.createBuffer(audioData, true);
                    soundSource.buffer = soundBuffer;

                    volumeNode = context.createGainNode();

                    //Set the volume
                    volumeNode.gain.value = 0.9;

                    // Wiring
                    soundSource.connect(volumeNode);
                    volumeNode.connect(context.destination);

                    console.log(context.destination);

                    // Finally
                    playSound(soundSource);
                }


                init();


            }());
        </script>
    </head>

    <body>
        <div style="background-color: green; width: 100px; height: 100px;" onClick="startSound();">test</div>

        <script src="http://argon.gatech.edu/argon_o.js"></script>

    </body>


</html>